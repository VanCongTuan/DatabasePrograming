@{

    Layout = "~/Views/Shared/LayoutThanhToan.cshtml";
    ViewBag.Title = "PayPal Payment";
    string clientId = "ARSkT360Ymc71XCZybF_SbnQAfoStlhbUoZCrVubYpJ9zDLo45L9sS9rmEIDU4H2USsk30vIpKa2y7k-"; // Thay bằng Client ID của bạn
    string currency = "USD";
    double amount = (@ViewBag.tong * ViewBag.adultNum + 100 * ViewBag.adultNum) + (@ViewBag.tong * 0.7 * ViewBag.childrenNum + 100 * ViewBag.childrenNum); // Số tiền
    var nguoiLon = ViewBag.nguoiLon as List<Dictionary<string, dynamic>>;
}
<header>
    <h2 class="AirlineName"><i>OPEN-AIRPLANE</i></h2>
    <nav class="LuaChon">
        <a href="/">Trang Chủ</a>
        <a href="/">Dịch Vụ Khác</a>
        <a href="/">Thông Tin</a>
        <a href="#">Liên Hệ</a>
        <button class="btnLienHe">Hotline</button>
    </nav>
</header>
<body>
    <form action="/payment" method="post">
        <div class="wrapper">
            <div class="hopInput">
                <h2 class="ten">Xin nhập thông tin để thanh toán</h2>
                <br>
                @Html.ActionLink(
              linkText: "Xác nhận",
              actionName: "Index",
              controllerName: "payment",
              routeValues: null,
              htmlAttributes: new { @class = "btnThanhToan" }
          )
                <br>
                <div class="nhapDichVu">
                    <label>Dịch vụ thanh toán :</label>
                    @if (!User.Identity.IsAuthenticated)
                    {
                        <select class="cacDichVu" name="loai" id="payment-method" onchange="thanhtoan(this)">
                            <option value="0"> Xin chọn một dịch vụ thanh toán </option>
                            <option value="1">Ngân hàng</option>
                            <option value="2">MoMo</option>
                            <option value="3">Visa</option>
                            <option value="PayPal">PayPal</option>
                        </select>
                    }
                    else
                    {
                        <select class="cacDichVu" name="loai" id="payment-method" onchange="thanhtoan(this)">
                            <option value="0"> Xin chọn một dịch vụ thanh toán </option>
                            <option value="2">MoMo</option>
                            <option value="TienMat">TienMat</option>
                        </select>
                    }
                </div>
                <div class="nhapDon">
                    @foreach (var i in ViewBag.maHD)
                    {
                        <label>Hóa đơn : @i </label>

                    }

                </div>

            </div>
            <div class="nhapTien" name="tien">
                <label>Tổng tiền thanh toán : @String.Format("{0:0,0 VNĐ}", (@ViewBag.tong * ViewBag.adultNum + 100 * ViewBag.adultNum) + (@ViewBag.tong * 0.7 * ViewBag.childrenNum + 100 * ViewBag.childrenNum)) $</label>
            </div>
            <a href="#">Hướng dẫn giao dịch thanh toán an toàn</a>
            <br><br>
            <a><b>Chúng tôi chỉ hỗ trợ thanh toán thẻ visa bằng Paypal</b></a>



            <div>
                <div class="thanhtoan">
                    <div id="paypal-button-container"></div>
                    <script src="https://www.paypal.com/sdk/js?client-id=@clientId&currency=@currency"></script>
                    <script>
        paypal.Buttons({
    createOrder: function(data, actions) {
        return actions.order.create({
            purchase_units: [{
                amount: {
                    value: '@amount'
                }
            }]
        });
    },
    onApprove: function(data, actions) {
        return actions.order.capture().then(function(details) {
            // Gửi orderId đến server
            fetch('/payment', {
                method: 'post',
                headers: {
                    'content-type': 'application/json'
                },
                body: JSON.stringify({
                    orderId: data.orderID
                })
            }).then(response => response.json()).then(data => {
                if (data.success) {
                    window.location.href = '/payment/Index'; // Chuyển sang trang thành công
                } else {
                    window.location.href = '/thanhtoan/Index'; // Chuyển sang trang thất bại
                }
            });
        });
    }
}).render('#paypal-button-container');
                    </script>
                </div>

            </div>
    </form>

    </div>


</body>
<script src="~/Content/static/js/thanhToan.js"></script>



